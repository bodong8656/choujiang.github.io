<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¾®ä¿¡å¹¸è¿å¤§æŠ½å¥–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px 15px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-area {
            text-align: center;
            padding: 30px 20px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #resultText {
            font-size: 28px;
            font-weight: bold;
            margin: 15px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .big-prize {
            animation: bigPrizeGlow 1s infinite alternate;
            font-size: 36px !important;
        }
        
        .draw-btn {
            width: 100%;
            padding: 20px;
            font-size: 22px;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255, 65, 108, 0.4);
            margin: 20px 0;
            user-select: none;
        }
        
        .draw-btn:active {
            transform: scale(0.98);
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
        }
        
        .draw-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab-bar {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .history-item {
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            animation: slideIn 0.3s ease;
        }
        
        .prize-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .prize-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 10px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .prize-item.special {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #333;
            font-weight: bold;
        }
        
        .prize-amount {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .prize-prob {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 20px;
        }
        
        .share-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            color: white;
            background: linear-gradient(45deg, #00b09b, #96c93d);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0, 176, 155, 0.3);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes bigPrizeGlow {
            from {
                text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
            }
            to {
                text-shadow: 0 0 20px #ff8c00, 0 0 40px #ff8c00;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @media (max-width: 400px) {
            .title { font-size: 28px; }
            .draw-btn { padding: 18px; font-size: 20px; }
            .prize-list { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ° å¹¸è¿å¤§æŠ½å¥–</h1>
            <p class="subtitle">å¾®ä¿¡ä¸“ç”¨ç‰ˆ Â· éšæ—¶æŠ½å¥– Â· éšæ—¶è®°å½•</p>
        </div>
        
        <div class="tab-bar">
            <div class="tab-btn active" onclick="switchTab(0)">ğŸ¯ æŠ½å¥–</div>
            <div class="tab-btn" onclick="switchTab(1)">ğŸ“Š è®°å½•</div>
            <div class="tab-btn" onclick="switchTab(2)">ğŸ“ˆ æ¦‚ç‡</div>
        </div>
        
        <div id="tab0" class="tab-content active">
            <div class="card result-area">
                <div id="resultLabel">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æŠ½å¥–</div>
                <div id="resultText">ğŸ</div>
                <div id="resultAnimation"></div>
            </div>
            
            <button class="draw-btn" id="drawButton" onclick="startDraw()">
                ğŸ² å¼€å§‹æŠ½å¥–
            </button>
            
            <div class="stats">
                <div>
                    <div style="font-size: 14px; opacity: 0.8;">æŠ½å¥–æ¬¡æ•°</div>
                    <div id="drawCount" style="font-size: 24px; font-weight: bold;">0</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 14px; opacity: 0.8;">ç´¯è®¡é‡‘é¢</div>
                    <div id="totalAmount" style="font-size: 24px; font-weight: bold;">0 å…ƒ</div>
                </div>
            </div>
        </div>
        
        <div id="tab1" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 15px;">ğŸ“‹ æŠ½å¥–å†å²</h3>
                <div class="history-list" id="historyList">
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.7);">
                        æš‚æ— æŠ½å¥–è®°å½•
                    </div>
                </div>
                <button class="share-btn" onclick="shareResults()">
                    ğŸ“¤ åˆ†äº«ç»“æœ
                </button>
            </div>
        </div>
        
        <div id="tab2" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 15px;">ğŸ¯ å¥–é¡¹è®¾ç½®</h3>
                <div class="prize-list" id="prizeList">
                    <!-- å¥–é¡¹åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">ğŸ’¡ æ¸©é¦¨æç¤º</div>
                    <div style="font-size: 14px;">ç‰¹ç­‰å¥–æ¦‚ç‡ä¸º0.001%ï¼Œå¹³å‡10ä¸‡æ¬¡å‡ºç°1æ¬¡</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const prizes = [2448, 24.88, 18.88, 16.88, 12.88, 6.88, 4.88, 2.88];
        const probabilities = [0.00001, 0.02, 0.03, 0.02, 0.03, 0.20, 0.35, 0.34999];
        
        let history = [];
        let drawCount = 0;
        let totalAmount = 0;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateStats();
            renderPrizes();
            renderHistory();
            
            // æ·»åŠ æŒ¯åŠ¨åé¦ˆï¼ˆå¦‚æœè®¾å¤‡æ”¯æŒï¼‰
            if ('vibrate' in navigator) {
                navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;
            }
        });
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const saved = localStorage.getItem('lotteryData');
            if (saved) {
                const data = JSON.parse(saved);
                history = data.history || [];
                drawCount = data.drawCount || 0;
                totalAmount = data.totalAmount || 0;
            }
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            const data = {
                history: history,
                drawCount: drawCount,
                totalAmount: totalAmount
            };
            localStorage.setItem('lotteryData', JSON.stringify(data));
        }
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            document.getElementById('drawCount').textContent = drawCount;
            document.getElementById('totalAmount').textContent = totalAmount.toFixed(2) + ' å…ƒ';
        }
        
        // æ¸²æŸ“å¥–é¡¹åˆ—è¡¨
        function renderPrizes() {
            const container = document.getElementById('prizeList');
            container.innerHTML = '';
            
            prizes.forEach((prize, index) => {
                const prob = probabilities[index] * 100;
                const isSpecial = prize === 2448;
                
                const item = document.createElement('div');
                item.className = `prize-item ${isSpecial ? 'special' : ''}`;
                item.innerHTML = `
                    <div class="prize-amount">${prize.toFixed(2)}å…ƒ</div>
                    <div class="prize-prob">æ¦‚ç‡: ${isSpecial ? prob.toFixed(4) : prob.toFixed(2)}%</div>
                `;
                container.appendChild(item);
            });
        }
        
        // æ¸²æŸ“å†å²è®°å½•
        function renderHistory() {
            const container = document.getElementById('historyList');
            
            if (history.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.7);">
                        æš‚æ— æŠ½å¥–è®°å½•
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            const recent = history.slice(-20).reverse();
            
            recent.forEach((item, index) => {
                const isSpecial = item === 2448;
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div>ç¬¬ ${history.length - index} æ¬¡</div>
                    <div style="font-weight: bold; ${isSpecial ? 'color: #ffd700;' : ''}">
                        ${item.toFixed(2)} å…ƒ ${isSpecial ? 'ğŸ¯' : ''}
                    </div>
                `;
                container.appendChild(historyItem);
            });
        }
        
        // æŠ½å¥–åŠ¨ç”»
        function startDraw() {
            const button = document.getElementById('drawButton');
            const resultLabel = document.getElementById('resultLabel');
            const resultText = document.getElementById('resultText');
            
            // ç¦ç”¨æŒ‰é’®
            button.disabled = true;
            button.innerHTML = '<div class="loading"></div>';
            
            // æŒ¯åŠ¨åé¦ˆ
            if (navigator.vibrate) navigator.vibrate([50]);
            
            // å¼€å§‹åŠ¨ç”»
            let animationFrames = 0;
            const animationInterval = setInterval(() => {
                animationFrames++;
                const randomPrize = prizes[Math.floor(Math.random() * (prizes.length - 1))];
                resultLabel.textContent = 'ğŸ² æŠ½å¥–ä¸­...';
                resultText.textContent = `${randomPrize.toFixed(2)} å…ƒ`;
                resultText.style.fontSize = (28 + Math.sin(animationFrames * 0.5) * 4) + 'px';
                
                // åŠ¨ç”»ç»“æŸ
                if (animationFrames >= 15) {
                    clearInterval(animationInterval);
                    
                    // æŠ½å¥–ç»“æœ
                    const result = drawPrize();
                    showResult(result);
                    
                    // æŒ¯åŠ¨åé¦ˆ
                    if (navigator.vibrate) {
                        navigator.vibrate(result === 2448 ? [200, 100, 200] : [100]);
                    }
                }
            }, 100);
        }
        
        // æŠ½å¥–é€»è¾‘
        function drawPrize() {
            const r = Math.random();
            let cp = 0;
            
            for (let i = 0; i < prizes.length; i++) {
                cp += probabilities[i];
                if (r <= cp) {
                    return prizes[i];
                }
            }
            return 2.88;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(prize) {
            const button = document.getElementById('drawButton');
            const resultLabel = document.getElementById('resultLabel');
            const resultText = document.getElementById('resultText');
            const isSpecial = prize === 2448;
            
            // æ˜¾ç¤ºç»“æœ
            resultLabel.textContent = isSpecial ? 'ğŸ‰ æ­å–œä¸­å¾—ç‰¹ç­‰å¥–ï¼' : 'âœ¨ æŠ½å¥–ç»“æœ';
            resultText.textContent = `${prize.toFixed(2)} å…ƒ`;
            resultText.className = isSpecial ? 'big-prize' : '';
            
            // ç‰¹æ®Šæ•ˆæœ
            if (isSpecial) {
                createConfetti();
                resultText.style.animation = 'pulse 0.5s 3, bounce 0.5s 3';
            }
            
            // æ›´æ–°è®°å½•
            history.push(prize);
            drawCount++;
            totalAmount += prize;
            
            // ä¿å­˜æ•°æ®
            saveData();
            updateStats();
            renderHistory();
            
            // æ¢å¤æŒ‰é’®
            setTimeout(() => {
                button.disabled = false;
                button.innerHTML = 'ğŸ² å†æ¬¡æŠ½å¥–';
                resultLabel.textContent = 'ç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å¥–';
            }, 1500);
        }
        
        // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
        function createConfetti() {
            const emojis = ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸˆ', 'ğŸ¥³', 'ğŸ†'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-50px';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    
                    document.body.appendChild(confetti);
                    
                    // åŠ¨ç”»
                    const animation = confetti.animate([
                        { top: '-50px', transform: `rotate(0deg)` },
                        { top: '120vh', transform: `rotate(${Math.random() * 720}deg)` }
                    ], {
                        duration: 2000 + Math.random() * 2000,
                        easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                    });
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤
                    animation.onfinish = () => confetti.remove();
                }, i * 100);
            }
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(index) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
            
            // æŒ¯åŠ¨åé¦ˆ
            if (navigator.vibrate) navigator.vibrate(30);
        }
        
        // åˆ†äº«ç»“æœ
        function shareResults() {
            if (history.length === 0) {
                alert('æš‚æ— æŠ½å¥–è®°å½•å¯åˆ†äº«');
                return;
            }
            
            const lastPrize = history[history.length - 1];
            const shareText = `ğŸ° æˆ‘åœ¨å¹¸è¿å¤§æŠ½å¥–ä¸­è·å¾—äº† ${lastPrize.toFixed(2)} å…ƒï¼\næ€»å…±æŠ½å¥– ${drawCount} æ¬¡ï¼Œç´¯è®¡ ${totalAmount.toFixed(2)} å…ƒ\nå¿«æ¥è¯•è¯•ä½ çš„è¿æ°”å§ï¼`;
            
            // å°è¯•ä½¿ç”¨Web Share API
            if (navigator.share) {
                navigator.share({
                    title: 'å¹¸è¿å¤§æŠ½å¥–ç»“æœ',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('æŠ½å¥–ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¿«å»åˆ†äº«ç»™æœ‹å‹å§ï¼');
                });
            }
        }
        
        // é•¿æŒ‰æ¸…ç©ºè®°å½•
        let clearTimer;
        document.addEventListener('DOMContentLoaded', function() {
            const historyTab = document.querySelector('.tab-bar').children[1];
            
            historyTab.addEventListener('touchstart', function(e) {
                clearTimer = setTimeout(() => {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                        history = [];
                        drawCount = 0;
                        totalAmount = 0;
                        saveData();
                        updateStats();
                        renderHistory();
                        alert('å†å²è®°å½•å·²æ¸…ç©ºï¼');
                    }
                }, 2000);
            });
            
            historyTab.addEventListener('touchend', function() {
                clearTimeout(clearTimer);
            });
        });
        
        // ç›‘å¬è¿”å›é”®
        window.addEventListener('popstate', function() {
            switchTab(0);
        });
        
        // é˜²æ­¢å¾®ä¿¡ä¸‹æ‹‰åˆ·æ–°
        document.addEventListener('touchmove', function(e) {
            if (e.target.tagName !== 'DIV' && e.target.className !== 'history-list') {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>