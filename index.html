<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒç‰ˆæœ¬æŠ½å¥– - æ™®é€š/ä½å»‰ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .version-switcher {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .version-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            font-weight: bold;
        }
        
        .version-btn.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .version-btn.premium {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #333;
        }
        
        .version-btn.economy {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
        }
        
        .version-info {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .result-area {
            text-align: center;
            padding: 30px 20px;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        #resultText {
            font-size: 28px;
            font-weight: bold;
            margin: 15px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .big-prize {
            animation: bigPrizeGlow 1s infinite alternate;
            font-size: 36px !important;
        }
        
        .draw-btn {
            width: 100%;
            padding: 20px;
            font-size: 22px;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255, 65, 108, 0.4);
            margin-bottom: 15px;
            user-select: none;
        }
        
        .draw-btn:active {
            transform: scale(0.98);
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
        }
        
        .draw-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #ff5858, #f09819);
            color: white;
        }
        
        .share-btn {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
        }
        
        .tab-bar {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 20px;
        }
        
        .history-item {
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        
        .clear-history-btn {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        
        .prize-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .prize-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 10px;
            border-radius: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .prize-item.special {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #333;
            font-weight: bold;
        }
        
        .prize-item.economy-special {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
            font-weight: bold;
        }
        
        .prize-amount {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .prize-prob {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .clear-confirm {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .confirm-box {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            max-width: 90%;
            width: 400px;
            text-align: center;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .confirm-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .confirm-yes {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        .confirm-no {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .version-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .tag-premium {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #333;
        }
        
        .tag-economy {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
        }
        
        @keyframes bigPrizeGlow {
            from {
                text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
            }
            to {
                text-shadow: 0 0 20px #ff8c00, 0 0 40px #ff8c00;
            }
        }
        
        @keyframes economyGlow {
            from {
                text-shadow: 0 0 10px #00b09b, 0 0 20px #00b09b;
            }
            to {
                text-shadow: 0 0 20px #96c93d, 0 0 40px #96c93d;
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @media (max-width: 400px) {
            .title { font-size: 28px; }
            .draw-btn { padding: 18px; font-size: 20px; }
            .prize-list { grid-template-columns: 1fr; }
            .action-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ° åŒç‰ˆæœ¬æŠ½å¥–</h1>
            <p class="subtitle">æ™®é€šç‰ˆ / ä½å»‰ç‰ˆè‡ªç”±åˆ‡æ¢</p>
        </div>
        
        <!-- ç‰ˆæœ¬åˆ‡æ¢å™¨ -->
        <div class="version-switcher">
            <div class="version-btn premium active" onclick="switchVersion('premium')">
                æ™®é€šç‰ˆ
            </div>
            <div class="version-btn economy" onclick="switchVersion('economy')">
                ä½å»‰ç‰ˆ
            </div>
        </div>
        
        <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
        <div class="version-info">
            <div id="versionName" style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">
                æ™®é€šç‰ˆæŠ½å¥–
            </div>
            <div id="versionDesc" style="font-size: 14px; opacity: 0.9;">
                å¤§å¥–2448å…ƒï¼Œæœ€é«˜æ¦‚ç‡35%
            </div>
        </div>
        
        <div class="tab-bar">
            <div class="tab-btn active" onclick="switchTab(0)">ğŸ¯ æŠ½å¥–</div>
            <div class="tab-btn" onclick="switchTab(1)">ğŸ“Š è®°å½•</div>
            <div class="tab-btn" onclick="switchTab(2)">ğŸ“ˆ æ¦‚ç‡</div>
        </div>
        
        <div id="tab0" class="tab-content active">
            <div class="card result-area">
                <div id="resultLabel">ç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å¥–</div>
                <div id="resultText">ğŸ</div>
                <div id="resultAnimation"></div>
            </div>
            
            <button class="draw-btn" id="drawButton" onclick="startDraw()">
                ğŸ² å¼€å§‹æŠ½å¥–
            </button>
            
            <div class="action-buttons">
                <button class="action-btn clear-btn" onclick="showClearConfirm()">
                    ğŸ—‘ï¸ æ¸…ç©ºè®°å½•
                </button>
                <button class="action-btn share-btn" onclick="shareResults()">
                    ğŸ“¤ åˆ†äº«
                </button>
            </div>
            
            <div class="stats">
                <div>
                    <div style="font-size: 14px; opacity: 0.8;">æŠ½å¥–æ¬¡æ•°</div>
                    <div id="drawCount" style="font-size: 24px; font-weight: bold;">0</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 14px; opacity: 0.8;">ç´¯è®¡é‡‘é¢</div>
                    <div id="totalAmount" style="font-size: 24px; font-weight: bold;">0 å…ƒ</div>
                </div>
            </div>
        </div>
        
        <div id="tab1" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">ğŸ“‹ æŠ½å¥–å†å²</h3>
                    <button class="clear-history-btn" onclick="showClearConfirm()">
                        ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨è®°å½•
                    </button>
                </div>
                
                <div class="history-list" id="historyList">
                    <div style="text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.7);">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                        <div>æš‚æ— æŠ½å¥–è®°å½•</div>
                        <div style="font-size: 14px; margin-top: 10px;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æŠ½å¥–</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <div style="font-size: 14px; opacity: 0.8;">ç»Ÿè®¡ä¿¡æ¯</div>
                            <div style="font-size: 18px; font-weight: bold;" id="statsSummary">0æ¬¡ / 0å…ƒ</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 14px; opacity: 0.8;">å¹³å‡å€¼</div>
                            <div style="font-size: 18px; font-weight: bold;" id="averageAmount">0å…ƒ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="tab2" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 15px;">ğŸ¯ å¥–é¡¹è®¾ç½®</h3>
                <div class="prize-list" id="prizeList">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <button class="action-btn" onclick="runProbabilityTest()" style="width: 100%; margin-top: 15px; background: linear-gradient(45deg, #8E2DE2, #4A00E0);">
                    ğŸ§ª è¿è¡Œæ¦‚ç‡æµ‹è¯•
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ¸…ç©ºç¡®è®¤å¯¹è¯æ¡† -->
    <div id="clearConfirm" class="clear-confirm" style="display: none;">
        <div class="confirm-box">
            <div style="font-size: 48px; margin-bottom: 15px;">âš ï¸</div>
            <h3 style="margin-bottom: 10px;">ç¡®è®¤æ¸…ç©º</h3>
            <p style="opacity: 0.9; margin-bottom: 5px;">ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æŠ½å¥–è®°å½•å—ï¼Ÿ</p>
            <p style="font-size: 14px; opacity: 0.7;">æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œæ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤</p>
            
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-yes" onclick="clearAllData()">
                    ç¡®å®šæ¸…ç©º
                </button>
                <button class="confirm-btn confirm-no" onclick="hideClearConfirm()">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ç‰ˆæœ¬é…ç½®
        const versions = {
            premium: {
                name: "æ™®é€šç‰ˆ",
                description: "å¤§å¥–2448å…ƒï¼Œæœ€é«˜æ¦‚ç‡35%",
                prizes: [2448, 24.88, 18.88, 16.88, 12.88, 6.88, 4.88, 2.88],
                probabilities: [0.00001, 0.02, 0.03, 0.02, 0.03, 0.20, 0.35, 0.34999],
                maxPrize: 2448,
                minPrize: 2.88,
                avgPrize: 7.85 // çº¦è®¡ç®—å¹³å‡å€¼
            },
            economy: {
                name: "ä½å»‰ç‰ˆ",
                description: "æœ€é«˜6.88å…ƒï¼Œæ¦‚ç‡æ›´å‡è¡¡",
                prizes: [6.88, 5.88, 4.88, 3.88, 2.88, 1.88, 0.88],
                probabilities: [0.10, 0.15, 0.15, 0.15, 0.15, 0.25, 0.25],
                maxPrize: 6.88,
                minPrize: 0.88,
                avgPrize: 3.23 // çº¦è®¡ç®—å¹³å‡å€¼
            }
        };
        
        // å½“å‰ç‰ˆæœ¬
        let currentVersion = 'premium';
        
        // æ•°æ®å­˜å‚¨ï¼ˆæŒ‰ç‰ˆæœ¬åˆ†å¼€ï¼‰
        let history = { premium: [], economy: [] };
        let drawCount = { premium: 0, economy: 0 };
        let totalAmount = { premium: 0, economy: 0 };
        
        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateVersionInfo();
            updateStats();
            renderPrizes();
            renderHistory();
            setupEventListeners();
        });
        
        // åŠ è½½æ•°æ®
        function loadData() {
            const saved = localStorage.getItem('lotteryDataV2');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    history = data.history || { premium: [], economy: [] };
                    drawCount = data.drawCount || { premium: 0, economy: 0 };
                    totalAmount = data.totalAmount || { premium: 0, economy: 0 };
                    currentVersion = data.currentVersion || 'premium';
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                    resetData();
                }
            }
        }
        
        // ä¿å­˜æ•°æ®
        function saveData() {
            const data = {
                history: history,
                drawCount: drawCount,
                totalAmount: totalAmount,
                currentVersion: currentVersion,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem('lotteryDataV2', JSON.stringify(data));
        }
        
        // åˆ‡æ¢ç‰ˆæœ¬
        function switchVersion(version) {
            currentVersion = version;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.version-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.version-btn.${version}`).classList.add('active');
            
            // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
            updateVersionInfo();
            
            // æ›´æ–°å¥–é¡¹æ˜¾ç¤º
            renderPrizes();
            
            // æ›´æ–°ç»Ÿè®¡
            updateStats();
            
            // æ›´æ–°å†å²è®°å½•
            renderHistory();
            
            // ä¿å­˜å½“å‰ç‰ˆæœ¬é€‰æ‹©
            saveData();
        }
        
        // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
        function updateVersionInfo() {
            const version = versions[currentVersion];
            document.getElementById('versionName').textContent = version.name + 'æŠ½å¥–';
            document.getElementById('versionDesc').textContent = version.description;
        }
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            const count = drawCount[currentVersion];
            const amount = totalAmount[currentVersion];
            
            document.getElementById('drawCount').textContent = count;
            document.getElementById('totalAmount').textContent = amount.toFixed(2) + ' å…ƒ';
            
            // æ›´æ–°ç»Ÿè®¡æ‘˜è¦
            const avg = count > 0 ? amount / count : 0;
            document.getElementById('statsSummary').textContent = `${count}æ¬¡ / ${amount.toFixed(2)}å…ƒ`;
            document.getElementById('averageAmount').textContent = avg.toFixed(2) + 'å…ƒ';
        }
        
        // æ¸²æŸ“å¥–é¡¹
        function renderPrizes() {
            const container = document.getElementById('prizeList');
            const version = versions[currentVersion];
            
            container.innerHTML = '';
            
            version.prizes.forEach((prize, index) => {
                const prob = version.probabilities[index] * 100;
                const isSpecial = prize === version.maxPrize;
                const isMin = prize === version.minPrize;
                
                const item = document.createElement('div');
                item.className = `prize-item ${isSpecial ? (currentVersion === 'premium' ? 'special' : 'economy-special') : ''}`;
                item.innerHTML = `
                    <div class="prize-amount">${prize.toFixed(2)}å…ƒ</div>
                    <div class="prize-prob">æ¦‚ç‡: ${prob.toFixed(2)}%</div>
                    ${isSpecial ? '<div style="font-size: 12px; margin-top: 5px;">ğŸ¯ æœ€é«˜å¥–</div>' : ''}
                    ${isMin ? '<div style="font-size: 12px; margin-top: 5px;">ğŸ’° æœ€ä½å¥–</div>' : ''}
                `;
                container.appendChild(item);
            });
        }
        
        // æ¸²æŸ“å†å²è®°å½•
        function renderHistory() {
            const container = document.getElementById('historyList');
            const currentHistory = history[currentVersion];
            
            if (currentHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: rgba(255,255,255,0.7);">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                        <div>æš‚æ— æŠ½å¥–è®°å½•</div>
                        <div style="font-size: 14px; margin-top: 10px;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æŠ½å¥–</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            const recent = currentHistory.slice(-50).reverse();
            
            recent.forEach((item, index) => {
                const isSpecial = item === versions[currentVersion].maxPrize;
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div>
                        <div style="font-size: 12px; opacity: 0.7;">ç¬¬ ${currentHistory.length - index} æ¬¡</div>
                        <div style="font-weight: bold; ${isSpecial ? (currentVersion === 'premium' ? 'color: #ffd700;' : 'color: #00b09b;') : ''}">
                            ${item.toFixed(2)} å…ƒ ${isSpecial ? 'ğŸ¯' : ''}
                            <span class="version-tag ${currentVersion === 'premium' ? 'tag-premium' : 'tag-economy'}">
                                ${currentVersion === 'premium' ? 'æ™®' : 'ä½'}
                            </span>
                        </div>
                    </div>
                    <button onclick="deleteSingleRecord(${currentHistory.length - index - 1})" 
                            style="background: rgba(255,255,255,0.1); border: none; color: #ff6b6b; padding: 5px 10px; border-radius: 5px; font-size: 12px;">
                        åˆ é™¤
                    </button>
                `;
                container.appendChild(historyItem);
            });
        }
        
        // æŠ½å¥–åŠ¨ç”»
        function startDraw() {
            const button = document.getElementById('drawButton');
            const resultLabel = document.getElementById('resultLabel');
            const resultText = document.getElementById('resultText');
            
            // ç¦ç”¨æŒ‰é’®
            button.disabled = true;
            button.innerHTML = 'ğŸ² æŠ½å¥–ä¸­...';
            
            // å¼€å§‹åŠ¨ç”»
            const version = versions[currentVersion];
            let animationFrames = 0;
            const animationInterval = setInterval(() => {
                animationFrames++;
                const randomPrize = version.prizes[Math.floor(Math.random() * version.prizes.length)];
                resultLabel.textContent = 'ğŸ² æŠ½å¥–ä¸­...';
                resultText.textContent = `${randomPrize.toFixed(2)} å…ƒ`;
                resultText.style.fontSize = (28 + Math.sin(animationFrames * 0.5) * 4) + 'px';
                
                // åŠ¨ç”»ç»“æŸ
                if (animationFrames >= 15) {
                    clearInterval(animationInterval);
                    const result = drawPrize();
                    showResult(result);
                }
            }, 100);
        }
        
        // æŠ½å¥–é€»è¾‘
        function drawPrize() {
            const version = versions[currentVersion];
            const r = Math.random();
            let cp = 0;
            
            for (let i = 0; i < version.prizes.length; i++) {
                cp += version.probabilities[i];
                if (r <= cp) {
                    return version.prizes[i];
                }
            }
            return version.minPrize; // å…œåº•è¿”å›æœ€ä½å¥–
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(prize) {
            const button = document.getElementById('drawButton');
            const resultLabel = document.getElementById('resultLabel');
            const resultText = document.getElementById('resultText');
            const version = versions[currentVersion];
            const isSpecial = prize === version.maxPrize;
            
            // æ˜¾ç¤ºç»“æœ
            resultLabel.textContent = isSpecial ? 'ğŸ‰ æ­å–œä¸­å¾—æœ€é«˜å¥–ï¼' : 'âœ¨ æŠ½å¥–ç»“æœ';
            resultText.textContent = `${prize.toFixed(2)} å…ƒ`;
            
            // ç‰¹æ®Šæ•ˆæœ
            if (isSpecial) {
                if (currentVersion === 'premium') {
                    resultText.className = 'big-prize';
                    resultText.style.animation = 'bigPrizeGlow 1s infinite alternate';
                } else {
                    resultText.style.animation = 'economyGlow 1s infinite alternate';
                }
                createConfetti(currentVersion);
            }
            
            // æ›´æ–°è®°å½•
            history[currentVersion].push(prize);
            drawCount[currentVersion]++;
            totalAmount[currentVersion] += prize;
            
            // ä¿å­˜æ•°æ®
            saveData();
            updateStats();
            renderHistory();
            
            // æ¢å¤æŒ‰é’®
            setTimeout(() => {
                button.disabled = false;
                button.innerHTML = 'ğŸ² å†æ¬¡æŠ½å¥–';
                resultLabel.textContent = 'ç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å¥–';
                resultText.style.animation = '';
            }, 1500);
        }
        
        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            // ç¡®è®¤æ˜¯å¦æ¸…ç©ºæ‰€æœ‰ç‰ˆæœ¬
            const clearAll = confirm('æ˜¯å¦æ¸…ç©ºæ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®ï¼Ÿ\né€‰æ‹©"å–æ¶ˆ"ä»…æ¸…ç©ºå½“å‰ç‰ˆæœ¬');
            
            if (clearAll) {
                // æ¸…ç©ºæ‰€æœ‰ç‰ˆæœ¬
                history = { premium: [], economy: [] };
                drawCount = { premium: 0, economy: 0 };
                totalAmount = { premium: 0, economy: 0 };
            } else {
                // ä»…æ¸…ç©ºå½“å‰ç‰ˆæœ¬
                history[currentVersion] = [];
                drawCount[currentVersion] = 0;
                totalAmount[currentVersion] = 0;
            }
            
            // ä¿å­˜æ•°æ®
            saveData();
            
            // æ›´æ–°ç•Œé¢
            updateStats();
            renderHistory();
            
            // éšè—ç¡®è®¤å¯¹è¯æ¡†
            hideClearConfirm();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showMessage('æ•°æ®å·²æ¸…ç©ºï¼');
        }
        
        // åˆ é™¤å•æ¡è®°å½•
        function deleteSingleRecord(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const currentHistory = history[currentVersion];
                const prize = currentHistory[index];
                currentHistory.splice(index, 1);
                drawCount[currentVersion]--;
                totalAmount[currentVersion] -= prize;
                
                saveData();
                updateStats();
                renderHistory();
                
                showMessage('è®°å½•å·²åˆ é™¤');
            }
        }
        
        // æ˜¾ç¤ºæ¸…ç©ºç¡®è®¤
        function showClearConfirm() {
            const currentHistory = history[currentVersion];
            if (currentHistory.length === 0) {
                showMessage('æš‚æ— æ•°æ®å¯æ¸…ç©º');
                return;
            }
            document.getElementById('clearConfirm').style.display = 'flex';
        }
        
        // éšè—æ¸…ç©ºç¡®è®¤
        function hideClearConfirm() {
            document.getElementById('clearConfirm').style.display = 'none';
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(index) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // æ›´æ–°å†…å®¹
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
        }
        
        // åˆ†äº«ç»“æœ
        function shareResults() {
            const currentHistory = history[currentVersion];
            if (currentHistory.length === 0) {
                showMessage('æš‚æ— æŠ½å¥–è®°å½•å¯åˆ†äº«');
                return;
            }
            
            const lastPrize = currentHistory[currentHistory.length - 1];
            const version = versions[currentVersion];
            const shareText = `ğŸ° æˆ‘åœ¨${version.name}æŠ½å¥–ä¸­è·å¾—äº† ${lastPrize.toFixed(2)} å…ƒï¼\næ€»å…±æŠ½å¥– ${drawCount[currentVersion]} æ¬¡ï¼Œç´¯è®¡ ${totalAmount[currentVersion].toFixed(2)} å…ƒ\nç‰ˆæœ¬ï¼š${version.name}\nå¿«æ¥è¯•è¯•ä½ çš„è¿æ°”å§ï¼`;
            
            if (navigator.share) {
                navigator.share({
                    title: `${version.name}æŠ½å¥–ç»“æœ`,
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showMessage('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                });
            }
        }
        
        // è¿è¡Œæ¦‚ç‡æµ‹è¯•
        function runProbabilityTest() {
            const version = versions[currentVersion];
            const testCount = 100000;
            const counts = {};
            
            // åˆå§‹åŒ–è®¡æ•°å™¨
            version.prizes.forEach(prize => {
                counts[prize] = 0;
            });
            
            // æ‰§è¡Œæµ‹è¯•
            for (let i = 0; i < testCount; i++) {
                const r = Math.random();
                let cp = 0;
                let prize = version.minPrize;
                
                for (let j = 0; j < version.prizes.length; j++) {
                    cp += version.probabilities[j];
                    if (r <= cp) {
                        prize = version.prizes[j];
                        break;
                    }
                }
                counts[prize]++;
            }
            
            // æ˜¾ç¤ºç»“æœ
            let resultText = `${version.name}æ¦‚ç‡æµ‹è¯•ç»“æœ (10ä¸‡æ¬¡):\n\n`;
            let totalProb = 0;
            
            version.prizes.forEach(prize => {
                const actual = (counts[prize] / testCount * 100).toFixed(3);
                const target = (version.probabilities[version.prizes.indexOf(prize)] * 100).toFixed(3);
                const diff = (actual - target).toFixed(3);
                const diffSign = diff >= 0 ? '+' : '';
                resultText += `${prize}å…ƒ: ${actual}% (ç›®æ ‡: ${target}% ${diffSign}${diff}%)\n`;
                totalProb += parseFloat(actual);
            });
            
            resultText += `\næ€»è®¡: ${totalProb.toFixed(3)}% (åº”æ¥è¿‘100%)`;
            resultText += `\nå¹³å‡æ¯æ¬¡: ${version.avgPrize.toFixed(2)}å…ƒ`;
            
            alert(resultText);
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
        function showMessage(message) {
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 10px;
                z-index: 1000;
                animation: fadeInOut 2s ease;
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 2000);
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // ç‚¹å‡»å¤–éƒ¨å…³é—­ç¡®è®¤å¯¹è¯æ¡†
            document.getElementById('clearConfirm').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideClearConfirm();
                }
            });
            
            // ESCé”®å…³é—­ç¡®è®¤å¯¹è¯æ¡†
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideClearConfirm();
                }
            });
        }
        
        // é‡ç½®æ•°æ®
        function resetData() {
            history = { premium: [], economy: [] };
            drawCount = { premium: 0, economy: 0 };
            totalAmount = { premium: 0, economy: 0 };
            saveData();
            updateStats();
            renderHistory();
        }
        
        // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
        function createConfetti(version) {
            const emojis = version === 'premium' 
                ? ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸˆ', 'ğŸ¥³', 'ğŸ†', 'ğŸ’°', 'ğŸ’']
                : ['ğŸ‰', 'ğŸŠ', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸˆ', 'ğŸ¥³', 'ğŸ’µ', 'ğŸ’¸', 'ğŸ¤‘'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    confetti.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}vw;
                        top: -50px;
                        font-size: 24px;
                        z-index: 1000;
                        pointer-events: none;
                        animation: confettiFall ${2 + Math.random() * 2}s linear forwards;
                    `;
                    
                    document.body.appendChild(confetti);
                    
                    // åŠ¨ç”»ç»“æŸåç§»é™¤
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 100);
            }
            
            // æ·»åŠ åŠ¨ç”»å…³é”®å¸§
            const style = document.createElement('style');
            style.textContent = `
                @keyframes confettiFall {
                    0% {
                        transform: translateY(0) rotate(0deg);
                        opacity: 1;
                    }
                    100% {
                        transform: translateY(100vh) rotate(720deg);
                        opacity: 0;
                    }
                }
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    20% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    80% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html> ${